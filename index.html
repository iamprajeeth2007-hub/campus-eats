<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campus Eats</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

:root{
    --primary:#FF6B35;
    --primary-dark:#E55A2B;
    --bg:#F5F5F5;
    --text:#1A1A1A;
}

body{
    font-family:'Plus Jakarta Sans',sans-serif;
    background:var(--bg);
    overflow:hidden;
    height:100vh;
}

/* SCREEN SYSTEM */
.screen{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100vh;
    overflow-y:auto;
    background:var(--bg);
}

.screen.active{
    display:block;
}

/* HEADER */
.header{
    position:fixed;
    top:0;
    width:100%;
    background:var(--primary);
    color:white;
    padding:15px;
    z-index:10;
}

.btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:10px;
    background:var(--primary);
    color:white;
    font-weight:700;
    cursor:pointer;
}

.container{
    padding:20px;
    padding-top:80px;
}

input, textarea{
    width:100%;
    padding:12px;
    margin-bottom:15px;
    border-radius:8px;
    border:1px solid #ddd;
}

.notification{
    position:fixed;
    top:20px;
    right:20px;
    background:black;
    color:white;
    padding:12px 20px;
    border-radius:10px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-screen" class="screen active">
<div class="container">
<h2>Login</h2>
<input type="tel" id="phone-input" placeholder="+91 9876543210">
<button class="btn" id="send-otp-btn">Send OTP</button>
<div id="recaptcha-container"></div>
</div>
</div>

<!-- OTP -->
<div id="otp-screen" class="screen">
<div class="container">
<h2>Enter OTP</h2>
<input type="text" id="otp-input" placeholder="123456">
<button class="btn" id="verify-otp-btn">Verify</button>
</div>
</div>

<!-- HOME -->
<div id="home-screen" class="screen">
<div class="header">Campus Eats</div>
<div class="container">
<h3>Restaurants Loaded From Firestore</h3>
<div id="restaurant-container">Loading...</div>
</div>
</div>

<!-- CONFIRMATION -->
<div id="confirmation-screen" class="screen">
<div class="container">
<h2>Order Placed âœ…</h2>
<h1 id="pickup-code-display"></h1>
<button class="btn" onclick="goHome()">Back Home</button>
</div>
</div>

<script>
// ðŸ”¥ REPLACE WITH YOUR REAL FIREBASE CONFIG
const firebaseConfig = {
    apiKey:"YOUR_API_KEY",
    authDomain:"YOUR_PROJECT.firebaseapp.com",
    projectId:"YOUR_PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let cart = [];
let currentVendorId = null;
let currentVendorName = "";

/* SCREEN SWITCH */
function showScreen(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

/* OTP LOGIN */
window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
    'recaptcha-container',
    { size:'invisible' }
);

document.getElementById("send-otp-btn").onclick = async ()=>{
    let phone = document.getElementById("phone-input").value;
    if(!phone.startsWith("+91")) phone="+91"+phone;

    try{
        const confirmation = await auth.signInWithPhoneNumber(phone, window.recaptchaVerifier);
        window.confirmationResult = confirmation;
        showScreen("otp-screen");
        notify("OTP Sent");
    }catch(e){
        notify("OTP Failed");
        console.error(e);
    }
};

document.getElementById("verify-otp-btn").onclick = async ()=>{
    const otp=document.getElementById("otp-input").value;
    try{
        await window.confirmationResult.confirm(otp);
        showScreen("home-screen");
        loadRestaurants();
        notify("Login Success");
    }catch(e){
        notify("Invalid OTP");
    }
};

/* LOAD RESTAURANTS */
async function loadRestaurants(){
    const container=document.getElementById("restaurant-container");
    container.innerHTML="Loading...";
    const snap=await db.collection("vendors").get();
    container.innerHTML="";
    snap.forEach(doc=>{
        container.innerHTML+=`<div>${doc.data().name}</div>`;
    });
}

/* CREATE ORDER */
async function createOrder(total){
    const user=auth.currentUser;
    const pickupCode=Math.floor(1000+Math.random()*9000).toString();

    await db.collection("orders").add({
        userId:user.uid,
        total:total,
        pickupCode:pickupCode,
        estimatedPickupTime:firebase.firestore.Timestamp.fromDate(
            new Date(Date.now()+25*60*1000)
        ),
        createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });

    document.getElementById("pickup-code-display").innerText=pickupCode;
    showScreen("confirmation-screen");
}

/* NOTIFICATION */
function notify(msg){
    const n=document.createElement("div");
    n.className="notification";
    n.innerText=msg;
    document.body.appendChild(n);
    setTimeout(()=>n.remove(),3000);
}

/* AUTH STATE */
auth.onAuthStateChanged(user=>{
    if(user){
        showScreen("home-screen");
        loadRestaurants();
    }
});
</script>

</body>
</html>
